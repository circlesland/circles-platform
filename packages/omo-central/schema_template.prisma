datasource db {
    provider = "postgresql"
    url = "REPLACE_ME_WITH_THE_CONNECTION_STRING"
}

generator client {
    provider = "prisma-client-js"
}

model Profile {
    // TODO: Is this always the same? Even for different devices?
    // did String
    fissionName String
    fissionRoot String?
    circlesAddress String?
    omoFirstName String?
    omoLastName String?
    offers Offer[]

    sentMessages Message[] @relation(name: "MessageSender")
    receivedMessages Message[] @relation(name: "MessageRecipient")

    @@unique([fissionName], name:"UX_Profile_fissionName")
}

model Offer {
    id Int @id @default(autoincrement())
    createdBy Profile @relation(name: "OfferCreatedBy", fields: [createdByFissionName], references: [fissionName])
    createdByFissionName String

    publishedAt DateTime
    unpublishedAt DateTime?

    title String
    price String            // price in wei
    deliveryTerms String    // pickup, delivery etc.
    pictures OfferPicture[]

    description String?
    category String?
    country String?
    city String?
}

model OfferPicture {
    offer Offer  @relation(name: "PictureOfOffer", fields: [offerId], references: [id])
    offerId Int
    pictureCid String
    @@unique([offerId, pictureCid], name:"UX_OfferPicture")
}

model Message {
    id Int @id @default(autoincrement())
    sender Profile @relation(name: "MessageSender", fields: [sentByFissionName], references: [fissionName])
    sentByFissionName String
    recipient Profile @relation(name: "MessageRecipient", fields: [receivedByFissionName], references: [fissionName])
    receivedByFissionName String
    type String
    cid String
}