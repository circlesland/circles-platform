datasource db {
    provider = "postgresql"
    url = "REPLACE_ME_WITH_THE_CONNECTION_STRING"
}

generator client {
    provider = "prisma-client-js"
}

model Profile {
    // TODO: Is this always the same? Even for different devices?
    // did String
    fissionName String
    fissionRoot String?
    circlesAddress String?
    omoFirstName String?
    omoLastName String?
    omoAvatarCid String?

    offers Offer[]

    sentMessages Message[] @relation(name: "MessageSender")
    receivedMessages Message[] @relation(name: "MessageRecipient")

    @@unique([fissionName], name:"UX_Profile_fissionName")
    @@unique([fissionRoot], name:"UX_Profile_fissionRoot")
}

model Offer {
    id Int @id @default(autoincrement())
    createdBy Profile @relation(name: "OfferCreatedBy", fields: [createdByFissionName], references: [fissionName])
    createdByFissionName String
    publishedAt DateTime
    unpublishedAt DateTime?

    title String
    price String            // price in wei
    description String?
    category String?
    country String?
    city String?
    deliveryTerms String    // pickup, delivery etc.

    pictures File[]
}

model File {
    offer Offer  @relation(name: "OfferPictures", fields: [offerId], references: [id])
    offerId Int
    size Int?
    mimeType String?
    cid String
    @@unique([offerId, cid], name:"UX_OfferPictures")
}

model Message {
    id Int @id @default(autoincrement())
    createdAt DateTime
    readAt DateTime?
    type String
    cid String

    sender Profile @relation(name: "MessageSender", fields: [senderFissionName], references: [fissionName])
    senderFissionName String

    recipient Profile @relation(name: "MessageRecipient", fields: [recipientFissionName], references: [fissionName])
    recipientFissionName String
}